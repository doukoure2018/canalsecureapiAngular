<ng-container *ngIf="homeState$ | async as state" [ngSwitch]="state.dataState">
  <ng-container *ngSwitchCase="DataState.LOADED">
    <app-navbar [user]="state.appData?.data?.user"></app-navbar>
    <app-stats [stats]="state.appData?.data?.stats"></app-stats>
    <section>
      <div class="container">
        <div
          *ngIf="(state.appData?.data?.stats?.expiredDate || '') 
           | expirationStatus:state.appData?.data?.stats?.status!:state.appData?.data?.stats?.balance! as expirationStatus">
          <div *ngIf="expirationStatus.type === 'attention'" class="alert alert-danger alert-dismissible">
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            <h4 class="alert-heading">Attention!</h4>
            <p class="mb-0">{{ expirationStatus.message }}</p>
          </div>
          <div *ngIf="expirationStatus.type === 'avertissement'" class="alert alert-warning alert-dismissible">
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            <h4 class="alert-heading">Avertissement!</h4>
            <p class="mb-0">{{ expirationStatus.message }}</p>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col text-start fw-bold">
            <h5>Toutes les Campaignes</h5>
          </div>
          <div class="row justify-content-end mb-3">
            <div class="col-auto">
              <button [routerLink]="['/campaigns/new']"
                class="btn btn-outline-success d-flex align-items-center fw-bold"
                style="font-size: 15px; cursor: pointer">
                <i class="bi bi-plus-lg me-2"></i>
                Programmer une Campagne
              </button>
            </div>
          </div>
          <div class="col-xm-12">
            <table mat-table [dataSource]="dataSource" matSort class="table table-hover table-bordered table-striped">
              <ng-container matColumnDef="index">
                <th mat-header-cell *matHeaderCellDef class="text-center"> # </th>
                <td mat-cell *matCellDef="let infoCampaign; let i = index" class="text-center">
                  {{ i + 1 }}
                </td>
                <!-- Sent Date Column -->
                <ng-container matColumnDef="createdAt">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-center"> Date </th>
                  <td mat-cell *matCellDef="let infoCampaign" class="text-center">
                    {{ infoCampaign.createdAt | date: 'dd/MM/yyyy, HH:mm' }}
                  </td>
                </ng-container>
              </ng-container>
              <!-- Message Column -->
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-center"> Message </th>
                <td mat-cell *matCellDef="let infoCampaign" class="text-center">
                  {{ infoCampaign.name }}
                </td>
              </ng-container>
              <!-- Status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Status </th>
                <td mat-cell *matCellDef="let infoCampaign" class="text-center">
                  <span class="badge text-light px-2 py-1" [ngClass]="{
                    'bg-success': infoCampaign.status === 'ACTIVE',
                    'bg-danger': infoCampaign.status === 'ATTENTE'
                  }">
                    {{ infoCampaign.status }}
                  </span>
                </td>
              </ng-container>
              <!-- Mode Column -->
              <ng-container matColumnDef="mode">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Mode </th>
                <td mat-cell *matCellDef="let infoCampaign" class="text-center">
                  <span class="badge text-light px-2 py-1" [ngClass]="{
                    'bg-warning': infoCampaign.mode === 'BROADCAST',
                    'bg-info': infoCampaign.mode === 'UNICAST'
                  }">
                    {{ infoCampaign.mode }}
                  </span>
                </td>
              </ng-container>
              <!-- Contact Column -->
              <ng-container matColumnDef="totalSms">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Nombre Sms </th>
                <td mat-cell *matCellDef="let infoCampaign" class="text-center">
                  {{ infoCampaign.totalSms }}
                </td>
              </ng-container>
              <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Action </th>
                <td mat-cell *matCellDef="let infoCampaign" class="text-center">
                  <button type="button" (click)="
                    selectCampaign(
                      infoCampaign,
                      state.appData?.data?.user!,
                      infoCampaign.mode!
                    )
                " class="btn btn-sm btn-info">
                    <i class="fas fa-eye"></i> View
                  </button>
                </td>
              </ng-container>
              <!-- Header and Row Definitions -->
              <tr mat-header-row *matHeaderRowDef="displayedColumns" class="table-primary"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="align-middle"></tr>
            </table>
            <!-- Paginator -->
            <mat-paginator [pageSizeOptions]="[10, 25, 50]" showFirstLastButtons></mat-paginator>
          </div>
        </div>
      </div>
    </section>
    <app-footer></app-footer>
  </ng-container>

  <ng-container *ngSwitchCase="DataState.LOADING">
    <div class="spinner">
      <p>Loading...</p>
    </div>
  </ng-container>

  <ng-container *ngSwitchCase="DataState.ERROR">
    <div>{{ state.error }}</div>
  </ng-container>
</ng-container>